<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>StudySpace - 移动端用户注册</title>
  <link rel="stylesheet" href="../desktop/admin-desktop/core/styles/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --auth-bg: radial-gradient(circle at 18% 22%, rgba(0, 122, 255, 0.12), transparent 34%),
        radial-gradient(circle at 78% 18%, rgba(90, 200, 250, 0.12), transparent 36%),
        radial-gradient(circle at 50% 82%, rgba(0, 122, 255, 0.08), transparent 38%),
        linear-gradient(180deg, #F2F3F7 0%, #E7E9F2 100%);
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-family-primary);
      background: var(--auth-bg);
      color: var(--color-text-primary);
      display: flex;
      justify-content: center;
      padding: 28px 16px 32px;
    }

    .page {
      width: min(390px, 100%);
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      min-height: calc(100vh - 60px);
    }

    .phone-shell {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid var(--color-border-secondary);
      border-radius: 46px;
      padding: 18px 16px 22px;
      box-shadow: var(--shadow-xl);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      height: 780px;
      max-height: calc(100vh - 40px);
      display: grid;
      gap: var(--spacing-md);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .status-bar {
      height: 44px;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      border-radius: 26px;
      box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.04);
      font-size: 14px;
      color: var(--color-text-primary);
      letter-spacing: 0.02em;
    }

    .status-bar__time { font-weight: 600; }

    .status-bar__icons {
      display: flex;
      gap: 6px;
      align-items: center;
      color: var(--color-text-primary);
    }

    .status-bar__icons i { font-size: 14px; }

    .card-header {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      justify-content: flex-start;
      padding: 8px 12px;
      border: 1px solid var(--color-border-secondary);
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, #F8FBFF 0%, #F1F6FF 60%, #FFFFFF 100%);
      box-shadow: var(--shadow-sm);
      font-weight: var(--font-weight-semibold);
    }

    .brand-logo {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: var(--color-primary-gradient);
      display: grid;
      place-items: center;
      color: #fff;
      font-weight: var(--font-weight-bold);
      letter-spacing: 0.02em;
      box-shadow: var(--shadow-lg);
    }

    .brand-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-title strong { font-size: 18px; letter-spacing: var(--letter-spacing-tight); }
    .brand-title span { color: var(--color-text-secondary); font-size: 13px; }

    .register-card {
      background: var(--glass-bg-dark);
      border: 1px solid var(--color-border-secondary);
      border-radius: var(--radius-xxl);
      padding: 18px 16px 20px;
      box-shadow: var(--shadow-lg);
      display: grid;
      gap: var(--spacing-md);
    }

    .register-card h2 {
      margin: 0;
      text-align: center;
      font-size: 18px;
      letter-spacing: var(--letter-spacing-tight);
      color: var(--color-text-primary);
    }

    .form-grid {
      display: grid;
      gap: var(--spacing-sm);
    }

    .field { display: grid; gap: 6px; }

    .field label {
      font-size: 14px;
      color: var(--color-text-primary);
      font-weight: var(--font-weight-semibold);
    }

    .input {
      width: 100%;
      padding: 10px 12px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--color-border-secondary);
      background: rgba(255, 255, 255, 0.94);
      font-size: 15px;
      transition: border-color var(--transition-normal), box-shadow var(--transition-normal);
    }

    .input:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.18);
    }

    .captcha-row {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }

    .captcha-row .input { flex: 1; }

    .btn-ghost {
      border: 1px solid var(--color-border-secondary);
      background: rgba(255, 255, 255, 0.9);
      border-radius: var(--radius-md);
      padding: 10px 12px;
      font-size: 14px;
      cursor: pointer;
      transition: transform var(--transition-bounce), box-shadow var(--transition-normal), border-color var(--transition-normal);
      white-space: nowrap;
    }

    .btn-ghost:hover { transform: translateY(-1px); border-color: var(--color-primary); box-shadow: var(--shadow-sm); }
    .btn-ghost:active { transform: translateY(0); }

    .btn-primary {
      border: none;
      background: var(--color-primary-gradient);
      color: #fff;
      padding: 14px 18px;
      border-radius: var(--radius-lg);
      font-size: 16px;
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
      box-shadow: var(--shadow-button);
      transition: transform var(--transition-bounce), box-shadow var(--transition-normal);
      width: 100%;
    }

    .btn-primary:hover { transform: translateY(-1px); box-shadow: var(--shadow-card-hover); }
    .btn-primary:active { transform: translateY(0); }

    .link-row {
      display: flex;
      gap: var(--spacing-sm);
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .link-button {
      border: 1px solid var(--color-border-secondary);
      background: rgba(255, 255, 255, 0.92);
      color: var(--color-text-primary);
      padding: 12px 14px;
      border-radius: var(--radius-lg);
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
      transition: border-color var(--transition-normal), box-shadow var(--transition-normal);
      flex: 1;
      min-width: 44%;
    }

    .link-button:hover { border-color: var(--color-primary); box-shadow: var(--shadow-sm); }

    .policy {
      font-size: 13px;
      color: var(--color-text-secondary);
      line-height: 1.5;
      background: rgba(245, 245, 247, 0.92);
      border: 1px solid var(--color-border-secondary);
      border-radius: var(--radius-xl);
      padding: 12px;
    }

    .policy a { color: var(--color-primary); text-decoration: none; font-weight: var(--font-weight-semibold); }
    .policy-check {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .policy-check input {
      margin-top: 2px;
      width: 16px;
      height: 16px;
      accent-color: var(--color-primary);
    }

    .policy-check span { flex: 1; }

    .form-message {
      border-radius: var(--radius-lg);
      padding: var(--spacing-sm) var(--spacing-md);
      font-size: 14px;
      display: none;
      align-items: center;
      gap: var(--spacing-sm);
      justify-content: center;
    }

    .form-message--error { display: flex; background: var(--color-error-bg); color: var(--color-error); border: 1px solid rgba(255, 59, 48, 0.2); }
    .form-message--success { display: flex; background: var(--color-success-bg); color: var(--color-success); border: 1px solid rgba(52, 199, 89, 0.2); }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 2000;
    }

    .modal-backdrop.is-open { display: flex; }

    .modal {
      width: min(540px, 100%);
      min-height: 60vh;
      max-height: 80vh;
      background: #fff;
      border-radius: var(--radius-xxl);
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--color-border-secondary);
      display: grid;
      grid-template-rows: auto 1fr auto;
      overflow: hidden;
    }

    .modal-header {
      padding: 14px 18px;
      border-bottom: 1px solid var(--color-border-secondary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--spacing-sm);
      background: linear-gradient(135deg, #F8FBFF 0%, #EEF4FF 60%, #FFFFFF 100%);
    }

    .modal-header strong { font-size: 16px; }

    .modal-body {
      padding: 14px 18px;
      overflow-y: auto;
      display: grid;
      gap: 10px;
      line-height: 1.6;
      color: var(--color-text-secondary);
    }

    .modal-body h4 { margin: 0; color: var(--color-text-primary); font-size: 15px; }
    .modal-body ul { margin: 0 0 6px 16px; padding: 0; }
    .modal-body li { margin-bottom: 4px; }

    .modal-footer {
      padding: 12px 16px;
      border-top: 1px solid var(--color-border-secondary);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      background: rgba(249, 250, 252, 0.9);
    }

    .btn-link {
      background: none;
      border: none;
      color: var(--color-primary);
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
    }

    @media (max-width: 480px) {
      body { padding: 20px 12px; }
      .phone-shell { padding: 14px 12px 18px; border-radius: 46px; height: 640px; max-height: calc(100vh - 32px); }
      .page { min-height: calc(100vh - 40px); }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="phone-shell">
      <div class="status-bar" aria-label="手机状态栏">
        <div class="status-bar__time" id="currentTime">14:30</div>
        <div class="status-bar__icons" aria-hidden="true">
          <i class="fas fa-signal"></i>
          <i class="fas fa-wifi"></i>
          <i class="fas fa-battery-three-quarters"></i>
        </div>
      </div>
      <div class="card-header" aria-label="注册标题">
        <div class="brand-logo">SS</div>
        <div class="brand-title">
          <strong>StudySpace 新用户注册</strong>
          <span>快速创建账户，开启高效自习</span>
        </div>
      </div>

      <section class="register-card" aria-label="注册输入框">
        <h2>快速创建学习账号</h2>
        <form class="form-grid" id="registerForm">
          <div class="field">
            <label for="realname">姓名 / 昵称</label>
            <input id="realname" class="input" type="text" name="realname" placeholder="请输入姓名或昵称" autocomplete="name" required>
          </div>
          <div class="field">
            <label for="phone">手机号码</label>
            <input id="phone" class="input" type="tel" name="phone" placeholder="用于接收预约提醒" autocomplete="tel" required>
          </div>
          <div class="field">
            <label for="email">常用邮箱</label>
            <input id="email" class="input" type="email" name="email" placeholder="用于接收通知" autocomplete="email" required>
          </div>
          <div class="field">
            <label for="password">设置登录密码</label>
            <input id="password" class="input" type="password" name="password" placeholder="至少 6 位字符" autocomplete="new-password" required>
          </div>
          <div class="field">
            <label for="confirmPassword">确认密码</label>
            <input id="confirmPassword" class="input" type="password" name="confirmPassword" placeholder="再次输入密码" autocomplete="new-password" required>
          </div>
          <div class="form-message" id="formMessage" aria-live="polite"></div>
          <button class="btn-primary" type="submit" id="registerBtn">提交注册</button>
        </form>
      </section>

      <div class="policy" aria-label="协议提示">
        <label class="policy-check">
          <input type="checkbox" id="agreePolicy">
          <span>注册即表示同意 <a href="#" title="用户协议" class="open-modal" data-type="tos">《用户协议》</a> 与 <a href="#" title="隐私政策" class="open-modal" data-type="privacy">《隐私政策》</a>，我们将为你保留预约记录、签到记录等学习数据。</span>
        </label>
      </div>

      <div class="link-row" aria-label="跳转操作">
        <button class="link-button" type="button" id="backToLogin">已有账号？去登录</button>
        <button class="link-button" type="button" id="toTask">返回</button>
      </div>
    </div>
  </div>

  <script>
    function updateCurrentTime() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
      const timeEl = document.getElementById('currentTime');
      if (timeEl) timeEl.textContent = timeStr;
    }
    updateCurrentTime();
    setInterval(updateCurrentTime, 60000);

    const form = document.querySelector('#registerForm');
    const formMessage = document.querySelector('#formMessage');
    const registerBtn = document.querySelector('#registerBtn');
    const agreePolicy = document.querySelector('#agreePolicy');

    function showMessage(text, type = 'error') {
      formMessage.textContent = text;
      formMessage.classList.remove('form-message--error', 'form-message--success');
      formMessage.classList.add(type === 'success' ? 'form-message--success' : 'form-message--error');
      formMessage.style.display = 'flex';
    }

    function clearMessage() {
      formMessage.textContent = '';
      formMessage.classList.remove('form-message--error', 'form-message--success');
      formMessage.style.display = 'none';
    }

    function goTo(path) {
      window.location.href = path;
    }

    form?.addEventListener('submit', (e) => {
      e.preventDefault();
      clearMessage();
      const realname = document.querySelector('#realname').value.trim();
      const phone = document.querySelector('#phone').value.trim();
      const email = document.querySelector('#email').value.trim();
      const password = document.querySelector('#password').value.trim();
      const confirmPassword = document.querySelector('#confirmPassword').value.trim();

      if (!realname || !phone || !email || !password || !confirmPassword) {
        showMessage('请完整填写全部注册信息');
        return;
      }

      if (password.length < 6) {
        showMessage('密码长度不足，请至少输入 6 位');
        return;
      }

      if (password !== confirmPassword) {
        showMessage('两次输入的密码不一致');
        return;
      }

      if (!agreePolicy?.checked) {
        showMessage('请先勾选并同意用户协议与隐私政策');
        return;
      }

      registerBtn.disabled = true;
      registerBtn.textContent = '提交中...';

      setTimeout(() => {
        showMessage('注册成功，正在跳转登录页...', 'success');
        setTimeout(() => goTo('移动用户端-进入页面.html'), 700);
        registerBtn.disabled = false;
        registerBtn.textContent = '提交注册';
      }, 800);
    });

    document.querySelector('#backToLogin')?.addEventListener('click', () => goTo('移动用户端-进入页面.html'));
    document.querySelector('#toTask')?.addEventListener('click', () => goTo('移动用户端-进入页面.html'));

    // Modal for TOS / Privacy
    const modalBackdrop = (() => {
      const el = document.createElement('div');
      el.className = 'modal-backdrop';
      el.innerHTML = `
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
          <div class="modal-header">
            <strong id="modalTitle">标题</strong>
            <button class="btn-link" type="button" id="closeModal">关闭</button>
          </div>
          <div class="modal-body" id="modalBody"></div>
          <div class="modal-footer">
            <button class="btn-ghost" type="button" id="modalOk">我已知晓</button>
          </div>
        </div>
      `;
      document.body.appendChild(el);
      return el;
    })();

    const modalTitle = modalBackdrop.querySelector('#modalTitle');
    const modalBody = modalBackdrop.querySelector('#modalBody');
    const closeModalBtn = modalBackdrop.querySelector('#closeModal');
    const modalOk = modalBackdrop.querySelector('#modalOk');

    const modalContent = {
      tos: {
        title: '用户协议要点',
        body: `
          <h4>账号使用</h4>
          <ul>
            <li>请使用本人手机号/邮箱注册，不得冒用他人信息。</li>
            <li>账号仅限本人使用，分享/出租/转让将导致封禁。</li>
          </ul>
          <h4>使用规范</h4>
          <ul>
            <li>禁止发布违规内容、恶意脚本或破坏性操作。</li>
            <li>尊重他人隐私，未经允许不得导出或传播团队资料。</li>
          </ul>
          <h4>数据与安全</h4>
          <ul>
            <li>开启二次验证保障账号安全，遗失密码可通过绑定方式找回。</li>
            <li>异常登录会提醒并可能触发二次验证。</li>
          </ul>
        `
      },
      privacy: {
        title: '隐私政策要点',
        body: `
          <h4>收集与使用</h4>
          <ul>
            <li>基础信息：手机号、邮箱、昵称，用于登录与通知。</li>
            <li>学习数据：预约、签到、任务进度，用于同步与统计。</li>
          </ul>
          <h4>存储与保护</h4>
          <ul>
            <li>数据加密存储，敏感字段脱敏展示。</li>
            <li>仅在业务需要的最短时间内保留，可随时申请删除。</li>
          </ul>
          <h4>你的权利</h4>
          <ul>
            <li>可请求导出/更正/删除个人数据。</li>
            <li>可随时撤回同意，但可能影响相关功能的正常使用。</li>
          </ul>
        `
      }
    };

    function openModal(type = 'tos') {
      const content = modalContent[type] || modalContent.tos;
      modalTitle.textContent = content.title;
      modalBody.innerHTML = content.body;
      modalBackdrop.classList.add('is-open');
    }

    function closeModal() {
      modalBackdrop.classList.remove('is-open');
    }

    closeModalBtn?.addEventListener('click', closeModal);
    modalOk?.addEventListener('click', closeModal);
    modalBackdrop?.addEventListener('click', (e) => {
      if (e.target === modalBackdrop) closeModal();
    });

    document.querySelectorAll('.open-modal').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        openModal(link.dataset.type);
      });
    });
  </script>
</body>
</html>
