<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åº§ä½ç®¡ç† - StudySpace ç®¡ç†åå°</title>
  <link rel="stylesheet" href="../../../core/styles/main.css">
  <link rel="stylesheet" href="../../../core/layouts/admin-layout/style.css">
  <link rel="stylesheet" href="../../../core/components/sidebar/style.css">
  <link rel="stylesheet" href="../../../core/components/navbar/style.css">
  <link rel="stylesheet" href="../../../core/components/search-bar/style.css">
  <link rel="stylesheet" href="../../../core/components/filter-dropdown/style.css">
  <link rel="stylesheet" href="../../../core/components/form-controls/style.css">
  <link rel="stylesheet" href="../../../core/components/button/style.css">
  <link rel="stylesheet" href="../../../core/components/toast/style.css">
  <link rel="stylesheet" href="../styles/seat-list.css">
</head>
<body>
  <div class="admin-layout">
    <!-- ä¾§è¾¹æ  -->
    <aside class="sidebar">
      <div class="sidebar__logo">
        <span class="sidebar__logo-text">StudySpace</span>
      </div>
      <nav class="sidebar__nav">
        <a href="../../dashboard/pages/overview.html" class="sidebar__nav-item" data-page="dashboard">
          <span class="sidebar__nav-text">ğŸ“Š é¢„çº¦ç®¡ç†</span>
        </a>
        <a href="seat-list.html" class="sidebar__nav-item sidebar__nav-item--active" data-page="seat-management">
          <span class="sidebar__nav-text">ğŸ’º åº§ä½ç®¡ç†</span>
        </a>
        <a href="../../study-record/pages/index.html" class="sidebar__nav-item" data-page="study-record">
          <span class="sidebar__nav-text">ğŸ“š å­¦ä¹ è®°å½•</span>
        </a>
        <a href="../../user-management/pages/index.html" class="sidebar__nav-item" data-page="user-management">
          <span class="sidebar__nav-text">ğŸ‘¥ ç”¨æˆ·ç®¡ç†</span>
        </a>
        <a href="../../announcement/pages/index.html" class="sidebar__nav-item" data-page="announcement">
          <span class="sidebar__nav-text">ğŸ“¢ å…¬å‘Šé€šçŸ¥</span>
        </a>
        <a href="../../settings/pages/index.html" class="sidebar__nav-item" data-page="settings">
          <span class="sidebar__nav-text">âš™ï¸ ç®¡ç†å‘˜è®¾ç½®</span>
        </a>
      </nav>
      
      <!-- ä¾§è¾¹æ åº•éƒ¨ç”¨æˆ·åŒºåŸŸ -->
      <div class="sidebar__footer">
        <div class="sidebar__user" id="userBtn">
          <div class="sidebar__user-avatar">ç®¡</div>
          <div class="sidebar__user-info">
            <span class="sidebar__user-name">ç®¡ç†å‘˜</span>
            <span class="sidebar__user-role">è¶…çº§ç®¡ç†å‘˜</span>
          </div>
          <span class="sidebar__user-menu">â–¼</span>
        </div>
        <div class="user-dropdown" id="userDropdown">
          <div class="user-dropdown__item">ğŸ‘¤ ä¸ªäººä¿¡æ¯</div>
          <div class="user-dropdown__item">ğŸ” ä¿®æ”¹å¯†ç </div>
          <div class="user-dropdown__divider"></div>
          <div class="user-dropdown__item user-dropdown__item--danger" id="logoutBtn">ğŸšª é€€å‡ºç™»å½•</div>
        </div>
      </div>
    </aside>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="admin-layout__main">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <header class="navbar navbar--fixed">
        <div class="search-bar">
          <input type="text" class="search-bar__input" placeholder="æœç´¢åº§ä½...">
          <button class="search-bar__btn" title="æœç´¢">æœç´¢</button>
        </div>
        <div class="navbar__right">
          <span class="navbar__time" id="currentTime"></span>
          <button class="navbar__notification">ğŸ””<span class="navbar__notification-badge"></span></button>
          <button class="navbar__filter-btn">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2z"/>
            </svg>
            ç­›é€‰
          </button>
        </div>
      </header>

      <!-- é¡µé¢å†…å®¹ -->
      <main class="admin-layout__content">
        <div class="seat-management">
          <!-- å·¦ä¾§ï¼šç­›é€‰ + åº§ä½ç½‘æ ¼ -->
          <div class="seat-management__main">
            <!-- ç­›é€‰åŒºåŸŸ -->
            <div class="filter-bar">
              <div class="filter-dropdown" id="floorDropdown">
                <button class="filter-dropdown__trigger" onclick="toggleDropdown('floorDropdown')">
                  <span class="filter-dropdown__label">æ¥¼å±‚ 1</span>
                  <span class="filter-dropdown__arrow">â–¾</span>
                </button>
                <div class="filter-dropdown__menu">
                  <div class="filter-dropdown__item filter-dropdown__item--active">æ¥¼å±‚ 1</div>
                  <div class="filter-dropdown__item">æ¥¼å±‚ 2</div>
                  <div class="filter-dropdown__item">æ¥¼å±‚ 3</div>
                </div>
              </div>

              <div class="filter-dropdown" id="areaDropdown">
                <button class="filter-dropdown__trigger" onclick="toggleDropdown('areaDropdown')">
                  <span class="filter-dropdown__label">åŒºåŸŸ A</span>
                  <span class="filter-dropdown__arrow">â–¾</span>
                </button>
                <div class="filter-dropdown__menu">
                  <div class="filter-dropdown__item filter-dropdown__item--active">åŒºåŸŸ A</div>
                  <div class="filter-dropdown__item">åŒºåŸŸ B</div>
                  <div class="filter-dropdown__item">åŒºåŸŸ C</div>
                  <div class="filter-dropdown__item">åŒºåŸŸ D</div>
                </div>
              </div>

              <div class="date-picker">
                <input type="text" class="date-picker__input" value="2025/11/29" readonly>
                <span class="date-picker__icon">ğŸ“…</span>
              </div>

              <div class="filter-dropdown" id="timeDropdown">
                <button class="filter-dropdown__trigger" onclick="toggleDropdown('timeDropdown')">
                  <span class="filter-dropdown__label">å…·ä½“æ—¶é—´</span>
                  <span class="filter-dropdown__arrow">â–¾</span>
                </button>
                <div class="filter-dropdown__menu">
                  <div class="filter-dropdown__item">08:00 - 10:00</div>
                  <div class="filter-dropdown__item">10:00 - 12:00</div>
                  <div class="filter-dropdown__item filter-dropdown__item--active">14:00 - 16:00</div>
                  <div class="filter-dropdown__item">16:00 - 18:00</div>
                  <div class="filter-dropdown__item">18:00 - 20:00</div>
                  <div class="filter-dropdown__item">20:00 - 22:00</div>
                </div>
              </div>
            </div>

            <!-- åº§ä½ç®¡ç†å·¥å…·æ  -->
            <div class="seat-toolbar">
              <!-- å·¦ä¾§ï¼šå›¾ä¾‹ -->
              <div class="seat-legend">
                <span class="legend-item"><span class="legend-dot legend-dot--available"></span>å¯ç”¨</span>
                <span class="legend-item"><span class="legend-dot legend-dot--occupied"></span>ä½¿ç”¨ä¸­</span>
                <span class="legend-item"><span class="legend-dot legend-dot--reserved"></span>å·²é¢„çº¦</span>
                <span class="legend-item"><span class="legend-dot legend-dot--maintenance"></span>ç»´æŠ¤ä¸­</span>
              </div>
              
              <!-- å³ä¾§ï¼šç¼–è¾‘æŒ‰é’® -->
              <button class="edit-mode-btn" id="toggleEditMode" onclick="toggleEditMode()">
                <span class="edit-mode-btn__icon">âœï¸</span>
                <span class="edit-mode-btn__text">ç¼–è¾‘å¸ƒå±€</span>
              </button>
            </div>

            <!-- ç¼–è¾‘æ¨¡å¼é¢æ¿ï¼ˆé»˜è®¤éšè—ï¼‰ -->
            <div class="edit-panel" id="editPanel" style="display: none;">
              <div class="edit-panel__header">
                <span class="edit-panel__title">ğŸ› ï¸ ç¼–è¾‘æ¨¡å¼</span>
                <span class="edit-panel__badge" id="selectionInfo">å·²é€‰ <strong id="selectedCount">0</strong> ä¸ª</span>
              </div>
              <div class="edit-panel__actions">
                <button class="edit-action-btn edit-action-btn--add" onclick="addSeatAtPosition()">
                  <span>â•</span> æ·»åŠ åº§ä½
                </button>
                <button class="edit-action-btn edit-action-btn--delete" onclick="deleteSelectedSeats()">
                  <span>ğŸ—‘ï¸</span> åˆ é™¤é€‰ä¸­
                </button>
                <button class="edit-action-btn edit-action-btn--move" onclick="moveSelectedSeats()">
                  <span>â†”ï¸</span> ç§»åŠ¨åº§ä½
                </button>
                <div class="edit-panel__divider"></div>
                <button class="edit-action-btn edit-action-btn--ghost" onclick="selectAllSeats()">å…¨é€‰</button>
                <button class="edit-action-btn edit-action-btn--ghost" onclick="clearSelection()">æ¸…é™¤é€‰æ‹©</button>
                <div class="edit-panel__divider"></div>
                <button class="edit-action-btn edit-action-btn--exit" onclick="toggleEditMode()">é€€å‡ºç¼–è¾‘</button>
              </div>
            </div>

            <!-- åº§ä½ç½‘æ ¼ -->
            <div class="seat-grid-container" id="seatGridContainer">
              <div class="seat-grid">
                <!-- ç¬¬1è¡Œ -->
                <div class="seat" data-seat-id="A01" data-status="available">
                  <span class="seat__label">A01</span>
                </div>
                <div class="seat" data-seat-id="A02" data-status="available">
                  <span class="seat__label">A02</span>
                </div>
                <div class="seat" data-seat-id="A03" data-status="available">
                  <span class="seat__label">A03</span>
                </div>
                <div class="seat" data-seat-id="A04" data-status="available">
                  <span class="seat__label">A04</span>
                </div>
                <div class="seat" data-seat-id="A05" data-status="available">
                  <span class="seat__label">A05</span>
                </div>
                <div class="seat" data-seat-id="A06" data-status="available">
                  <span class="seat__label">A06</span>
                </div>
                <!-- ç¬¬2è¡Œ -->
                <div class="seat" data-seat-id="A07" data-status="available">
                  <span class="seat__label">A07</span>
                </div>
                <div class="seat" data-seat-id="A08" data-status="available">
                  <span class="seat__label">A08</span>
                </div>
                <div class="seat" data-seat-id="A09" data-status="available">
                  <span class="seat__label">A09</span>
                </div>
                <div class="seat" data-seat-id="A10" data-status="reserved">
                  <span class="seat__label">A10</span>
                </div>
                <div class="seat" data-seat-id="A11" data-status="available">
                  <span class="seat__label">A11</span>
                </div>
                <div class="seat" data-seat-id="A12" data-status="available">
                  <span class="seat__label">A12</span>
                </div>
                <!-- ç¬¬3è¡Œ -->
                <div class="seat" data-seat-id="A13" data-status="available">
                  <span class="seat__label">A13</span>
                </div>
                <div class="seat" data-seat-id="A14" data-status="available">
                  <span class="seat__label">A14</span>
                </div>
                <div class="seat seat--selected" data-seat-id="A15" data-status="available">
                  <span class="seat__label">A15</span>
                </div>
                <div class="seat" data-seat-id="A16" data-status="occupied">
                  <span class="seat__label">A16</span>
                </div>
                <div class="seat" data-seat-id="A17" data-status="available">
                  <span class="seat__label">A17</span>
                </div>
                <div class="seat" data-seat-id="A18" data-status="available">
                  <span class="seat__label">A18</span>
                </div>
                <!-- ç¬¬4è¡Œ -->
                <div class="seat" data-seat-id="A19" data-status="available">
                  <span class="seat__label">A19</span>
                </div>
                <div class="seat" data-seat-id="A20" data-status="available">
                  <span class="seat__label">A20</span>
                </div>
                <div class="seat" data-seat-id="A21" data-status="available">
                  <span class="seat__label">A21</span>
                </div>
                <div class="seat" data-seat-id="A22" data-status="reserved">
                  <span class="seat__label">A22</span>
                </div>
                <div class="seat" data-seat-id="A23" data-status="available">
                  <span class="seat__label">A23</span>
                </div>
                <div class="seat" data-seat-id="A24" data-status="available">
                  <span class="seat__label">A24</span>
                </div>
                <!-- ç¬¬5è¡Œ -->
                <div class="seat" data-seat-id="A25" data-status="available">
                  <span class="seat__label">A25</span>
                </div>
                <div class="seat" data-seat-id="A26" data-status="disabled">
                  <span class="seat__label">A26</span>
                </div>
                <div class="seat" data-seat-id="A27" data-status="available">
                  <span class="seat__label">A27</span>
                </div>
                <div class="seat" data-seat-id="A28" data-status="available">
                  <span class="seat__label">A28</span>
                </div>
                <div class="seat" data-seat-id="A29" data-status="available">
                  <span class="seat__label">A29</span>
                </div>
                <div class="seat" data-seat-id="A30" data-status="available">
                  <span class="seat__label">A30</span>
                </div>
              </div>

              <!-- åº§ä½å›¾ä¾‹ -->
              <div class="seat-legend">
                <div class="seat-legend__item">
                  <span class="seat-legend__dot seat-legend__dot--available"></span>
                  <span class="seat-legend__text">å¯ç”¨</span>
                </div>
                <div class="seat-legend__item">
                  <span class="seat-legend__dot seat-legend__dot--reserved"></span>
                  <span class="seat-legend__text">å·²é¢„çº¦</span>
                </div>
                <div class="seat-legend__item">
                  <span class="seat-legend__dot seat-legend__dot--occupied"></span>
                  <span class="seat-legend__text">ä½¿ç”¨ä¸­</span>
                </div>
                <div class="seat-legend__item">
                  <span class="seat-legend__dot seat-legend__dot--disabled"></span>
                  <span class="seat-legend__text">ä¸å¯ç”¨</span>
                </div>
                <div class="seat-legend__item">
                  <span class="seat-legend__dot seat-legend__dot--selected"></span>
                  <span class="seat-legend__text">å·²é€‰ä¸­</span>
                </div>
              </div>
            </div>
          </div>

          <!-- å³ä¾§ï¼šåº§ä½è¯¦ç»†ä¿¡æ¯é¢æ¿ -->
          <div class="seat-detail-panel" id="seatDetailPanel">
            <div class="seat-detail-panel__header">
              <h3 class="seat-detail-panel__title">åº§ä½è¯¦ç»†ä¿¡æ¯</h3>
            </div>

            <div class="seat-detail-panel__body">
              <!-- åº§ä½å· -->
              <div class="detail-section">
                <label class="detail-section__label">åº§ä½å·</label>
                <div class="detail-section__value">
                  <input type="text" class="form-input" id="seatNumber" value="A15" placeholder="åº§ä½å·">
                </div>
              </div>

              <!-- è®¾æ–½ -->
              <div class="detail-section">
                <label class="detail-section__label">è®¾æ–½</label>
                <div class="detail-section__checkboxes">
                  <label class="form-checkbox">
                    <input type="checkbox" class="form-checkbox__input" checked>
                    <span class="form-checkbox__box"></span>
                    <span class="form-checkbox__label">è®¾æ–½1ï¼ˆç”µæºæ’åº§ï¼‰</span>
                  </label>
                  <label class="form-checkbox">
                    <input type="checkbox" class="form-checkbox__input" checked>
                    <span class="form-checkbox__box"></span>
                    <span class="form-checkbox__label">è®¾æ–½2ï¼ˆå°ç¯ï¼‰</span>
                  </label>
                  <label class="form-checkbox">
                    <input type="checkbox" class="form-checkbox__input">
                    <span class="form-checkbox__box"></span>
                    <span class="form-checkbox__label">è®¾æ–½3ï¼ˆæ˜¾ç¤ºå™¨ï¼‰</span>
                  </label>
                </div>
              </div>

              <!-- é¢„çº¦çŠ¶æ€ -->
              <div class="detail-section">
                <label class="detail-section__label">é¢„çº¦çŠ¶æ€</label>
                <div class="detail-section__value">
                  <select class="form-select" id="reservationStatus">
                    <option value="available" selected>å¯é¢„çº¦</option>
                    <option value="reserved">å·²é¢„çº¦</option>
                    <option value="occupied">ä½¿ç”¨ä¸­</option>
                    <option value="disabled">ä¸å¯ç”¨</option>
                  </select>
                </div>
              </div>

              <!-- é¢„çº¦æ—¥æœŸå’Œæ—¶é—´ -->
              <div class="detail-section">
                <label class="detail-section__label">é¢„çº¦æ—¥æœŸå’Œæ—¶é—´</label>
                <div class="detail-section__datetime">
                  <input type="text" class="form-input" value="2025/11/29" placeholder="æ—¥æœŸ">
                  <input type="text" class="form-input" value="14:00 - 16:00" placeholder="æ—¶é—´æ®µ">
                </div>
              </div>

              <!-- åº§ä½ç®¡ç† -->
              <div class="detail-section">
                <label class="detail-section__label">åº§ä½ç®¡ç†</label>
                <div class="detail-section__value">
                  <select class="form-select" id="seatManagement">
                    <option value="normal" selected>æ­£å¸¸ä½¿ç”¨</option>
                    <option value="maintenance">ç»´æŠ¤ä¸­</option>
                    <option value="reserved-admin">ç®¡ç†å‘˜é¢„ç•™</option>
                    <option value="disabled">åœç”¨</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="seat-detail-panel__footer">
              <button class="btn btn--primary" id="saveBtn">ä¿å­˜</button>
              <button class="btn btn--secondary" id="cancelBtn">å–æ¶ˆ</button>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // ä¸‹æ‹‰æ¡†äº¤äº’
    function toggleDropdown(id) {
      const dropdown = document.getElementById(id);
      const isOpen = dropdown.classList.contains('filter-dropdown--open');
      
      document.querySelectorAll('.filter-dropdown').forEach(d => {
        d.classList.remove('filter-dropdown--open');
      });
      
      if (!isOpen) {
        dropdown.classList.add('filter-dropdown--open');
      }
    }
    
    // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰æ¡†
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.filter-dropdown')) {
        document.querySelectorAll('.filter-dropdown').forEach(d => {
          d.classList.remove('filter-dropdown--open');
        });
      }
    });
    
    // é€‰æ‹©ä¸‹æ‹‰é¡¹
    document.querySelectorAll('.filter-dropdown__item').forEach(item => {
      item.addEventListener('click', function() {
        const dropdown = this.closest('.filter-dropdown');
        const label = dropdown.querySelector('.filter-dropdown__label');
        
        dropdown.querySelectorAll('.filter-dropdown__item').forEach(i => {
          i.classList.remove('filter-dropdown__item--active');
        });
        this.classList.add('filter-dropdown__item--active');
        label.textContent = this.textContent;
        dropdown.classList.remove('filter-dropdown--open');
      });
    });

    // åº§ä½é€‰æ‹©äº¤äº’
    document.querySelectorAll('.seat').forEach(seat => {
      seat.addEventListener('click', function() {
        const status = this.dataset.status;
        
        // ç§»é™¤å…¶ä»–åº§ä½çš„é€‰ä¸­çŠ¶æ€
        document.querySelectorAll('.seat').forEach(s => {
          s.classList.remove('seat--selected');
        });
        
        // é€‰ä¸­å½“å‰åº§ä½
        this.classList.add('seat--selected');
        
        // æ›´æ–°å³ä¾§é¢æ¿ä¿¡æ¯
        updateDetailPanel(this);
      });
    });

    // æ›´æ–°è¯¦æƒ…é¢æ¿
    function updateDetailPanel(seatElement) {
      const seatId = seatElement.dataset.seatId;
      const status = seatElement.dataset.status;
      
      document.getElementById('seatNumber').value = seatId;
      
      const statusMap = {
        'available': 'available',
        'reserved': 'reserved',
        'occupied': 'occupied',
        'disabled': 'disabled'
      };
      document.getElementById('reservationStatus').value = statusMap[status] || 'available';
      
      // æ˜¾ç¤ºé¢æ¿ï¼ˆç§»åŠ¨ç«¯ï¼‰
      document.getElementById('seatDetailPanel').classList.add('seat-detail-panel--visible');
    }

    // ä¿å­˜æŒ‰é’®
    document.getElementById('saveBtn').addEventListener('click', function() {
      const selectedSeat = document.querySelector('.seat--selected');
      if (selectedSeat) {
        const newStatus = document.getElementById('reservationStatus').value;
        selectedSeat.dataset.status = newStatus;
        
        // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
        this.textContent = 'å·²ä¿å­˜ âœ“';
        this.classList.add('btn--success');
        setTimeout(() => {
          this.textContent = 'ä¿å­˜';
          this.classList.remove('btn--success');
        }, 1500);
      }
    });

    // å–æ¶ˆæŒ‰é’®
    document.getElementById('cancelBtn').addEventListener('click', function() {
      document.querySelectorAll('.seat').forEach(s => {
        s.classList.remove('seat--selected');
      });
      document.getElementById('seatDetailPanel').classList.remove('seat-detail-panel--visible');
    });

    // ç”¨æˆ·ä¸‹æ‹‰èœå•
    const userBtn = document.getElementById('userBtn');
    const userDropdown = document.getElementById('userDropdown');
    const logoutBtn = document.getElementById('logoutBtn');

    userBtn?.addEventListener('click', (e) => {
      e.stopPropagation();
      userDropdown.classList.toggle('show');
    });

    document.addEventListener('click', (e) => {
      if (!e.target.closest('.sidebar__footer')) {
        userDropdown?.classList.remove('show');
      }
    });

    logoutBtn?.addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        window.location.href = '../../../pages/login.html';
      }
    });

    // æ˜¾ç¤ºå½“å‰æ—¶é—´
    function updateTime() {
      const now = new Date();
      const options = { month: 'short', day: 'numeric', weekday: 'short', hour: '2-digit', minute: '2-digit' };
      const timeEl = document.getElementById('currentTime');
      if (timeEl) timeEl.textContent = now.toLocaleString('zh-CN', options);
    }
    updateTime();
    setInterval(updateTime, 60000);

    // ========== Toast æç¤º ==========
    function showToast(message, type = 'info') {
      const existing = document.querySelector('.toast');
      if (existing) existing.remove();
      
      const toast = document.createElement('div');
      toast.className = `toast toast--${type}`;
      toast.innerHTML = `<span>${message}</span>`;
      toast.style.cssText = `
        position: fixed;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 24px;
        background: ${type === 'success' ? '#34C759' : type === 'error' ? '#FF3B30' : '#007AFF'};
        color: white;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 500;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        z-index: 9999;
        animation: toastIn 0.3s ease;
      `;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'toastOut 0.3s ease forwards';
        setTimeout(() => toast.remove(), 300);
      }, 2500);
    }

    // Toast åŠ¨ç”»
    const toastStyle = document.createElement('style');
    toastStyle.textContent = `
      @keyframes toastIn { from { opacity: 0; transform: translateX(-50%) translateY(-20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
      @keyframes toastOut { from { opacity: 1; } to { opacity: 0; } }
    `;
    document.head.appendChild(toastStyle);

    // ========== æœç´¢æ¡†äº¤äº’ ==========
    document.querySelector('.search-bar__input')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && e.target.value.trim()) {
        showToast(`æ­£åœ¨æœç´¢åº§ä½: "${e.target.value.trim()}"`, 'info');
      }
    });

    // ========== é€šçŸ¥æŒ‰é’® ==========
    document.querySelector('.navbar__notification')?.addEventListener('click', () => {
      showToast('æ‚¨æœ‰ 2 æ¡åº§ä½ç»´æŠ¤æé†’', 'info');
    });

    // ========== ç­›é€‰æŒ‰é’® ==========
    document.querySelector('.navbar__filter-btn')?.addEventListener('click', () => {
      showToast('é«˜çº§ç­›é€‰é¢æ¿å·²æ‰“å¼€', 'info');
    });

    // ========== æ—¥æœŸé€‰æ‹©å™¨ ==========
    document.querySelector('.date-picker')?.addEventListener('click', function() {
      const input = this.querySelector('.date-picker__input');
      const dates = ['2025/11/29', '2025/11/30', '2025/12/01'];
      const currentIndex = dates.indexOf(input.value);
      input.value = dates[(currentIndex + 1) % dates.length];
      showToast(`å·²åˆ‡æ¢åˆ° ${input.value}`, 'success');
    });

    // ========== åº§ä½å›¾ä¾‹ç‚¹å‡» ==========
    document.querySelectorAll('.seat-legend__item').forEach(item => {
      item.style.cursor = 'pointer';
      item.addEventListener('click', function() {
        const text = this.querySelector('.seat-legend__text')?.textContent;
        showToast(`ç­›é€‰æ˜¾ç¤º: ${text}åº§ä½`, 'info');
      });
    });

    // ========== è®¾æ–½å¤é€‰æ¡†å˜åŒ– ==========
    document.querySelectorAll('.form-checkbox__input').forEach(checkbox => {
      checkbox.addEventListener('change', function() {
        const label = this.closest('.form-checkbox').querySelector('.form-checkbox__label')?.textContent;
        showToast(`${this.checked ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}: ${label}`, 'success');
      });
    });

    // ========== çŠ¶æ€é€‰æ‹©å˜åŒ– ==========
    document.getElementById('reservationStatus')?.addEventListener('change', function() {
      const statusText = this.options[this.selectedIndex].text;
      showToast(`çŠ¶æ€å·²æ›´æ”¹ä¸º: ${statusText}`, 'info');
    });

    // ========== åº§ä½ç®¡ç†é€‰æ‹©å˜åŒ– ==========
    document.getElementById('seatManagement')?.addEventListener('change', function() {
      const text = this.options[this.selectedIndex].text;
      showToast(`ç®¡ç†çŠ¶æ€: ${text}`, 'info');
    });

    // ========== ç”¨æˆ·èœå•é¡¹äº¤äº’ ==========
    document.querySelectorAll('.user-dropdown__item:not(.user-dropdown__item--danger)').forEach(item => {
      item.addEventListener('click', function() {
        const text = this.textContent.trim();
        showToast(`æ­£åœ¨æ‰“å¼€${text.replace(/[^\u4e00-\u9fa5]/g, '')}...`, 'info');
        userDropdown.classList.remove('show');
      });
    });

    // ========== ç¼–è¾‘æ¨¡å¼åŠŸèƒ½ ==========
    let isEditMode = false;
    let selectedSeats = new Set();

    // åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
    function toggleEditMode() {
      isEditMode = !isEditMode;
      const container = document.getElementById('seatGridContainer');
      const editPanel = document.getElementById('editPanel');
      const toggleBtn = document.getElementById('toggleEditMode');

      if (isEditMode) {
        // è¿›å…¥ç¼–è¾‘æ¨¡å¼
        container.classList.add('edit-mode');
        editPanel.style.display = 'block';
        toggleBtn.style.display = 'none';
        Toast.success('ğŸ› ï¸ ç¼–è¾‘æ¨¡å¼å·²å¼€å¯ï¼Œç‚¹å‡»åº§ä½å¯é€‰æ‹©');
        enableSeatSelection();
      } else {
        // é€€å‡ºç¼–è¾‘æ¨¡å¼
        container.classList.remove('edit-mode');
        editPanel.style.display = 'none';
        toggleBtn.style.display = 'flex';
        clearSelection();
        disableSeatSelection();
        Toast.info('ç¼–è¾‘æ¨¡å¼å·²å…³é—­');
      }
    }

    // å¯ç”¨åº§ä½é€‰æ‹©
    function enableSeatSelection() {
      document.querySelectorAll('.seat').forEach(seat => {
        seat.addEventListener('click', handleSeatClick);
      });
    }

    // ç¦ç”¨åº§ä½é€‰æ‹©
    function disableSeatSelection() {
      document.querySelectorAll('.seat').forEach(seat => {
        seat.removeEventListener('click', handleSeatClick);
      });
    }

    // å¤„ç†åº§ä½ç‚¹å‡»
    function handleSeatClick(e) {
      if (!isEditMode) return;
      
      const seat = e.currentTarget;
      const seatId = seat.dataset.seatId;
      
      if (selectedSeats.has(seatId)) {
        selectedSeats.delete(seatId);
        seat.classList.remove('selected');
      } else {
        selectedSeats.add(seatId);
        seat.classList.add('selected');
      }
      
      updateSelectionCount();
    }

    // æ›´æ–°é€‰æ‹©è®¡æ•°
    function updateSelectionCount() {
      document.getElementById('selectedCount').textContent = selectedSeats.size;
    }

    // å…¨é€‰åº§ä½
    function selectAllSeats() {
      document.querySelectorAll('.seat').forEach(seat => {
        const seatId = seat.dataset.seatId;
        selectedSeats.add(seatId);
        seat.classList.add('selected');
      });
      updateSelectionCount();
      Toast.info(`å·²é€‰æ‹© ${selectedSeats.size} ä¸ªåº§ä½`);
    }

    // æ¸…é™¤é€‰æ‹©
    function clearSelection() {
      document.querySelectorAll('.seat.selected').forEach(seat => {
        seat.classList.remove('selected');
      });
      selectedSeats.clear();
      updateSelectionCount();
    }

    // åœ¨æŒ‡å®šä½ç½®æ·»åŠ åº§ä½
    function addSeatAtPosition() {
      showAddSeatModal();
    }

    // æ˜¾ç¤ºæ·»åŠ åº§ä½å¼¹çª—
    function showAddSeatModal() {
      const modal = document.createElement('div');
      modal.className = 'move-seat-modal';
      modal.id = 'addSeatModal';
      modal.innerHTML = `
        <div class="move-seat-modal__content">
          <h3 class="move-seat-modal__title">æ·»åŠ æ–°åº§ä½</h3>
          <div class="form-group">
            <label class="form-label">åº§ä½ç¼–å·</label>
            <input type="text" class="form-input" id="newSeatId" placeholder="å¦‚ï¼šA33">
          </div>
          <div class="form-group">
            <label class="form-label">åº§ä½ç±»å‹</label>
            <select class="form-select" id="newSeatType">
              <option value="standard">æ ‡å‡†åº§ä½</option>
              <option value="computer">ç”µè„‘åº§ä½</option>
              <option value="premium">VIPåº§ä½</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">åˆå§‹çŠ¶æ€</label>
            <select class="form-select" id="newSeatStatus">
              <option value="available">å¯ç”¨</option>
              <option value="maintenance">ç»´æŠ¤ä¸­</option>
            </select>
          </div>
          <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
            <button class="btn btn--secondary" onclick="closeAddSeatModal()">å–æ¶ˆ</button>
            <button class="btn btn--primary" onclick="confirmAddSeat()">æ·»åŠ åº§ä½</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      setTimeout(() => modal.classList.add('show'), 10);
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeAddSeatModal();
      });
    }

    function closeAddSeatModal() {
      const modal = document.getElementById('addSeatModal');
      if (modal) {
        modal.classList.remove('show');
        setTimeout(() => modal.remove(), 300);
      }
    }

    function confirmAddSeat() {
      const seatId = document.getElementById('newSeatId').value.trim().toUpperCase();
      const seatType = document.getElementById('newSeatType').value;
      const seatStatus = document.getElementById('newSeatStatus').value;
      
      if (!seatId) {
        Toast.error('è¯·è¾“å…¥åº§ä½ç¼–å·');
        return;
      }
      
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
      if (document.querySelector(`[data-seat-id="${seatId}"]`)) {
        Toast.error('è¯¥åº§ä½ç¼–å·å·²å­˜åœ¨');
        return;
      }
      
      // åˆ›å»ºæ–°åº§ä½
      const seatGrid = document.querySelector('.seat-grid');
      const newSeat = document.createElement('div');
      newSeat.className = 'seat';
      newSeat.dataset.seatId = seatId;
      newSeat.dataset.status = seatStatus;
      newSeat.innerHTML = `<span class="seat__label">${seatId}</span>`;
      
      // æ·»åŠ äº‹ä»¶ç›‘å¬
      if (isEditMode) {
        newSeat.addEventListener('click', handleSeatClick);
      }
      
      seatGrid.appendChild(newSeat);
      closeAddSeatModal();
      Toast.success(`åº§ä½ ${seatId} æ·»åŠ æˆåŠŸ`);
    }

    // åˆ é™¤é€‰ä¸­çš„åº§ä½
    function deleteSelectedSeats() {
      if (selectedSeats.size === 0) {
        Toast.warning('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„åº§ä½');
        return;
      }
      
      if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedSeats.size} ä¸ªåº§ä½å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
        selectedSeats.forEach(seatId => {
          const seat = document.querySelector(`[data-seat-id="${seatId}"]`);
          if (seat) {
            seat.remove();
          }
        });
        
        Toast.success(`å·²åˆ é™¤ ${selectedSeats.size} ä¸ªåº§ä½`);
        selectedSeats.clear();
        updateSelectionCount();
      }
    }

    // ç§»åŠ¨é€‰ä¸­çš„åº§ä½
    function moveSelectedSeats() {
      if (selectedSeats.size === 0) {
        Toast.warning('è¯·å…ˆé€‰æ‹©è¦ç§»åŠ¨çš„åº§ä½');
        return;
      }
      
      showMoveSeatModal();
    }

    // æ˜¾ç¤ºç§»åŠ¨åº§ä½å¼¹çª—
    function showMoveSeatModal() {
      const modal = document.createElement('div');
      modal.className = 'move-seat-modal';
      modal.id = 'moveSeatModal';
      modal.innerHTML = `
        <div class="move-seat-modal__content">
          <h3 class="move-seat-modal__title">ç§»åŠ¨åº§ä½åˆ°</h3>
          <div class="move-options">
            <div class="move-option" data-target="area-a" onclick="selectMoveTarget(this)">
              <div class="move-option__icon">ğŸ…°ï¸</div>
              <div class="move-option__title">AåŒº</div>
            </div>
            <div class="move-option" data-target="area-b" onclick="selectMoveTarget(this)">
              <div class="move-option__icon">ğŸ…±ï¸</div>
              <div class="move-option__title">BåŒº</div>
            </div>
            <div class="move-option" data-target="area-c" onclick="selectMoveTarget(this)">
              <div class="move-option__icon">Â©ï¸</div>
              <div class="move-option__title">CåŒº</div>
            </div>
            <div class="move-option" data-target="area-d" onclick="selectMoveTarget(this)">
              <div class="move-option__icon">ğŸ‡©</div>
              <div class="move-option__title">DåŒº</div>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">æ–°ç¼–å·å‰ç¼€</label>
            <input type="text" class="form-input" id="newPrefix" placeholder="å¦‚ï¼šB" value="B">
            <div class="form-help">åº§ä½å°†é‡æ–°ç¼–å·ä¸º B01, B02, ...</div>
          </div>
          <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
            <button class="btn btn--secondary" onclick="closeMoveSeatModal()">å–æ¶ˆ</button>
            <button class="btn btn--primary" onclick="confirmMoveSeat()">ç¡®è®¤ç§»åŠ¨</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      setTimeout(() => modal.classList.add('show'), 10);
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeMoveSeatModal();
      });
    }

    function selectMoveTarget(element) {
      document.querySelectorAll('.move-option').forEach(opt => opt.classList.remove('selected'));
      element.classList.add('selected');
      
      // æ›´æ–°å‰ç¼€
      const target = element.dataset.target;
      const prefix = target.split('-')[1].toUpperCase();
      document.getElementById('newPrefix').value = prefix;
    }

    function closeMoveSeatModal() {
      const modal = document.getElementById('moveSeatModal');
      if (modal) {
        modal.classList.remove('show');
        setTimeout(() => modal.remove(), 300);
      }
    }

    function confirmMoveSeat() {
      const prefix = document.getElementById('newPrefix').value.trim().toUpperCase();
      
      if (!prefix) {
        Toast.error('è¯·è¾“å…¥æ–°ç¼–å·å‰ç¼€');
        return;
      }
      
      let index = 1;
      selectedSeats.forEach(seatId => {
        const seat = document.querySelector(`[data-seat-id="${seatId}"]`);
        if (seat) {
          const newId = prefix + String(index).padStart(2, '0');
          seat.dataset.seatId = newId;
          seat.querySelector('.seat__label').textContent = newId;
          index++;
        }
      });
      
      closeMoveSeatModal();
      Toast.success(`å·²å°† ${selectedSeats.size} ä¸ªåº§ä½ç§»åŠ¨åˆ° ${prefix} åŒº`);
      clearSelection();
    }
  </script>
  
  <!-- åŠŸèƒ½è„šæœ¬ -->
  <script src="../../../core/components/toast/toast.js"></script>
</body>
</html>
